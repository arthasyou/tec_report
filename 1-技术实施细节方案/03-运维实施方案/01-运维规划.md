# 运维实施规划

本运维规划旨在为未来各类新项目构建标准化、自动化、可持续交付的 DevOps 能力，满足同时部署至 C 端云服务器和 B 端客户独立服务器的需求。

## 1. 基础设施部署标准化

- GitLab 自建部署，统一管理代码仓库与权限
- Docker Registry 私有镜像仓库搭建，统一镜像管理与分发
- GitLab Runner 部署并维护，支持多 Runner 执行并行任务
- 集中式配置服务（如 Nacos、Consul）部署规范（可选）
- 所有核心服务必须支持 docker-compose 一键部署

## 2. CI/CD 流水线规范

- 所有项目必须具备 `.gitlab-ci.yml` 配置
- 自动构建、自动测试、自动打包、自动推送镜像
- 可根据标签/分支触发不同环境部署流程（如 dev / prod）
- 自动生成版本号、变更日志、构建信息等元数据
- 审核合并后自动部署预设环境（开发服务器或测试服务器）

## 3. 服务部署规范

- 所有服务必须提供 Dockerfile + docker-compose.yml
- 支持一键部署 + 一键重启 + 日志查看
- B 端部署脚本支持配置化（如服务端口、自定义环境变量）
- C 端可选集成 K8s Helm Charts（后期扩展）

## 4. 运维工具链配置

- Prometheus + Grafana：用于服务监控与预警（CPU、内存、响应耗时等）
- Loki + Grafana 或 ELK：用于集中式日志收集与分析
- Uptime Kuma 或 PingCAP Cloud 可选用于外部可用性监控
- Watchtower：用于自动镜像更新（C 端云部署场景）

## 5. 安全与权限控制

- 所有 CI/CD 密钥、Token、部署凭证存储于 GitLab CI Secret 中
- 服务部署前强制执行端口、目录、变量合法性校验
- 对外暴露服务采用网关统一代理，限制 IP 白名单
- 定期扫描镜像安全漏洞，强制更新依赖版本

## 6. 人员职责与运维流程

- 运维工程师负责：
  - 保证基础平台服务稳定运行
  - 编写与维护部署脚本
  - 持续优化部署速度与资源消耗
  - 定期编写运维手册与故障应急预案

- 所有开发人员需遵循：
  - 提交代码必须通过 CI 检查
  - 不得直接登录生产环境操作
  - 合理提交日志，辅助监控分析与排查

## 7. 后续可扩展方向

- 云端 DevOps 平台（如 GitLab SaaS、GitHub Actions）与本地自建并行适配
- 引入 ArgoCD / Flux 等 GitOps 工具实现声明式部署
- 使用 Terraform / Ansible 等工具管理服务器基础设施
